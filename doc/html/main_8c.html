<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Arduino Kernel: src/main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Arduino Kernel
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">main.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="tasks_8h_source.html">sys/tasks.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timer_8h_source.html">tmr/timer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="system_8h_source.html">sys/system.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="user_8h_source.html">user.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="stack_8h_source.html">sys/stack.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="software__timer_8h_source.html">tmr/software_timer.h</a>&quot;</code><br />
</div>
<p><a href="main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a> ()</td></tr>
<tr class="memdesc:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the kernel and start the schedule. Main begins by initializing tasks. After that, it sets their stacks. Following that, the timers are initialized. After that, control is given to the scheduler.  <a href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">More...</a><br /></td></tr>
<tr class="separator:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab3562635582eb878114a9a09ff37ac51"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ab3562635582eb878114a9a09ff37ac51">_etext</a></td></tr>
<tr class="separator:ab3562635582eb878114a9a09ff37ac51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa048857b192a9992e900dab95ce0eefa"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structstack.html">stack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#aa048857b192a9992e900dab95ce0eefa">s</a></td></tr>
<tr class="separator:aa048857b192a9992e900dab95ce0eefa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8880edb4f19530cbc9a91fc403b34a18"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structtask.html">task</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a8880edb4f19530cbc9a91fc403b34a18">tasks</a> [<a class="el" href="user_8h.html#aa3bb33230c3f665f70c09261ad9d05bb">TASK_COUNT</a>]</td></tr>
<tr class="separator:a8880edb4f19530cbc9a91fc403b34a18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9082ba995307e1da6cfac9cbc7013cb"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structtask.html">task</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#af9082ba995307e1da6cfac9cbc7013cb">curr</a></td></tr>
<tr class="separator:af9082ba995307e1da6cfac9cbc7013cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ae66f6b31b5ad750f1fe042a706a4e3d4" name="ae66f6b31b5ad750f1fe042a706a4e3d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae66f6b31b5ad750f1fe042a706a4e3d4">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the kernel and start the schedule. Main begins by initializing tasks. After that, it sets their stacks. Following that, the timers are initialized. After that, control is given to the scheduler. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00021">21</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>
<div class="fragment"><div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>           {</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>    <span class="keywordtype">int</span> result = 0;</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>    <span class="comment">// Create linked list</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code hl_define" href="user_8h.html#aa3bb33230c3f665f70c09261ad9d05bb">TASK_COUNT</a>; ++i) {</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>        <span class="keywordflow">if</span> (!i) {</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>            <a class="code hl_function" href="tasks_8h.html#a8f3b3f66bb8e0d63257a14dd1f91ab88">make_task</a>(<a class="code hl_variable" href="main_8c.html#af9082ba995307e1da6cfac9cbc7013cb">curr</a>, &amp;<a class="code hl_variable" href="main_8c.html#a8880edb4f19530cbc9a91fc403b34a18">tasks</a>[i], <a class="code hl_variable" href="user_8h.html#a89f22a038576c59ed14bb45877f31edd">task_funct</a>[i]);</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>        }</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>        <a class="code hl_function" href="tasks_8h.html#a8f3b3f66bb8e0d63257a14dd1f91ab88">make_task</a>(&amp;<a class="code hl_variable" href="main_8c.html#a8880edb4f19530cbc9a91fc403b34a18">tasks</a>[i-1], &amp;<a class="code hl_variable" href="main_8c.html#a8880edb4f19530cbc9a91fc403b34a18">tasks</a>[i], <a class="code hl_variable" href="user_8h.html#a89f22a038576c59ed14bb45877f31edd">task_funct</a>[i]);</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>    }</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>    <a class="code hl_variable" href="main_8c.html#a8880edb4f19530cbc9a91fc403b34a18">tasks</a>[<a class="code hl_define" href="user_8h.html#aa3bb33230c3f665f70c09261ad9d05bb">TASK_COUNT</a>-1].<a class="code hl_variable" href="structtask.html#ae949d26b280beacfbb782fa148c8505d">next</a> = &amp;<a class="code hl_variable" href="main_8c.html#a8880edb4f19530cbc9a91fc403b34a18">tasks</a>[0];</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    <span class="comment">// Set stack pointers for each task</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    result = <a class="code hl_function" href="tasks_8h.html#ae921328ce3374b0e5b00a0cd7c70e78e">set_task_stacks</a>(&amp;<a class="code hl_variable" href="main_8c.html#a8880edb4f19530cbc9a91fc403b34a18">tasks</a>[0], <a class="code hl_define" href="user_8h.html#aa3bb33230c3f665f70c09261ad9d05bb">TASK_COUNT</a>, &amp;<a class="code hl_variable" href="main_8c.html#aa048857b192a9992e900dab95ce0eefa">s</a>, <a class="code hl_variable" href="main_8c.html#aa048857b192a9992e900dab95ce0eefa">s</a>.<a class="code hl_variable" href="structstack.html#a53b6c1e0e68bd42af28e62a0a2193326">stack_num</a>);</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    <span class="comment">// If there was an issue with this, exit with error</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    <span class="keywordflow">if</span> (!result) {</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>        <span class="keywordflow">goto</span> error;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    }</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    <span class="comment">// Set the timer</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <a class="code hl_function" href="timer_8h.html#ac98c657d442f70782236967f9e0b5457">init_timers</a>();</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    <span class="comment">/* This will jump to the house keeper. The house keeper will</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment">     * find a new task and do some house keeping stuff</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment">     */</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <a class="code hl_function" href="system_8h.html#a00920ea269df4a5e8b7fa427c807edb7">task_yield</a>();</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <span class="comment">/* This should never be reached */</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>error:</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <span class="keywordflow">while</span> (1);</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>}</div>
<div class="ttc" id="amain_8c_html_a8880edb4f19530cbc9a91fc403b34a18"><div class="ttname"><a href="main_8c.html#a8880edb4f19530cbc9a91fc403b34a18">tasks</a></div><div class="ttdeci">struct task tasks[TASK_COUNT]</div><div class="ttdef"><b>Definition:</b> <a href="user_8c_source.html#l00022">user.c:22</a></div></div>
<div class="ttc" id="amain_8c_html_aa048857b192a9992e900dab95ce0eefa"><div class="ttname"><a href="main_8c.html#aa048857b192a9992e900dab95ce0eefa">s</a></div><div class="ttdeci">struct stack s</div><div class="ttdef"><b>Definition:</b> <a href="user_8c_source.html#l00040">user.c:40</a></div></div>
<div class="ttc" id="amain_8c_html_af9082ba995307e1da6cfac9cbc7013cb"><div class="ttname"><a href="main_8c.html#af9082ba995307e1da6cfac9cbc7013cb">curr</a></div><div class="ttdeci">struct task * curr</div><div class="ttdef"><b>Definition:</b> <a href="user_8c_source.html#l00036">user.c:36</a></div></div>
<div class="ttc" id="astructstack_html_a53b6c1e0e68bd42af28e62a0a2193326"><div class="ttname"><a href="structstack.html#a53b6c1e0e68bd42af28e62a0a2193326">stack::stack_num</a></div><div class="ttdeci">size_t stack_num</div><div class="ttdef"><b>Definition:</b> <a href="stack_8h_source.html#l00013">stack.h:13</a></div></div>
<div class="ttc" id="astructtask_html_ae949d26b280beacfbb782fa148c8505d"><div class="ttname"><a href="structtask.html#ae949d26b280beacfbb782fa148c8505d">task::next</a></div><div class="ttdeci">struct task * next</div><div class="ttdef"><b>Definition:</b> <a href="tasks_8h_source.html#l00070">tasks.h:70</a></div></div>
<div class="ttc" id="asystem_8h_html_a00920ea269df4a5e8b7fa427c807edb7"><div class="ttname"><a href="system_8h.html#a00920ea269df4a5e8b7fa427c807edb7">task_yield</a></div><div class="ttdeci">static void task_yield()</div><div class="ttdef"><b>Definition:</b> <a href="system_8h_source.html#l00013">system.h:13</a></div></div>
<div class="ttc" id="atasks_8h_html_a8f3b3f66bb8e0d63257a14dd1f91ab88"><div class="ttname"><a href="tasks_8h.html#a8f3b3f66bb8e0d63257a14dd1f91ab88">make_task</a></div><div class="ttdeci">void make_task(struct task *p, struct task *curr, void(*task_funct)())</div><div class="ttdoc">Initialize a task.</div><div class="ttdef"><b>Definition:</b> <a href="tasks_8c_source.html#l00018">tasks.c:18</a></div></div>
<div class="ttc" id="atasks_8h_html_ae921328ce3374b0e5b00a0cd7c70e78e"><div class="ttname"><a href="tasks_8h.html#ae921328ce3374b0e5b00a0cd7c70e78e">set_task_stacks</a></div><div class="ttdeci">int set_task_stacks(struct task *t, size_t task_num, struct stack *s, size_t stack_num)</div><div class="ttdoc">Set up the stack for a given task.</div><div class="ttdef"><b>Definition:</b> <a href="tasks_8c_source.html#l00056">tasks.c:56</a></div></div>
<div class="ttc" id="atimer_8h_html_ac98c657d442f70782236967f9e0b5457"><div class="ttname"><a href="timer_8h.html#ac98c657d442f70782236967f9e0b5457">init_timers</a></div><div class="ttdeci">void init_timers()</div><div class="ttdef"><b>Definition:</b> <a href="timer_8c_source.html#l00018">timer.c:18</a></div></div>
<div class="ttc" id="auser_8h_html_a89f22a038576c59ed14bb45877f31edd"><div class="ttname"><a href="user_8h.html#a89f22a038576c59ed14bb45877f31edd">task_funct</a></div><div class="ttdeci">void(* task_funct[TASK_COUNT])()</div><div class="ttdef"><b>Definition:</b> <a href="user_8c_source.html#l00018">user.c:18</a></div></div>
<div class="ttc" id="auser_8h_html_aa3bb33230c3f665f70c09261ad9d05bb"><div class="ttname"><a href="user_8h.html#aa3bb33230c3f665f70c09261ad9d05bb">TASK_COUNT</a></div><div class="ttdeci">#define TASK_COUNT</div><div class="ttdef"><b>Definition:</b> <a href="user_8h_source.html#l00026">user.h:26</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab3562635582eb878114a9a09ff37ac51" name="ab3562635582eb878114a9a09ff37ac51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3562635582eb878114a9a09ff37ac51">&#9670;&nbsp;</a></span>_etext</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t _etext</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="af9082ba995307e1da6cfac9cbc7013cb" name="af9082ba995307e1da6cfac9cbc7013cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9082ba995307e1da6cfac9cbc7013cb">&#9670;&nbsp;</a></span>curr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structtask.html">task</a>* curr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="user_8c_source.html#l00036">36</a> of file <a class="el" href="user_8c_source.html">user.c</a>.</p>

</div>
</div>
<a id="aa048857b192a9992e900dab95ce0eefa" name="aa048857b192a9992e900dab95ce0eefa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa048857b192a9992e900dab95ce0eefa">&#9670;&nbsp;</a></span>s</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structstack.html">stack</a> s</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="user_8c_source.html#l00040">40</a> of file <a class="el" href="user_8c_source.html">user.c</a>.</p>

</div>
</div>
<a id="a8880edb4f19530cbc9a91fc403b34a18" name="a8880edb4f19530cbc9a91fc403b34a18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8880edb4f19530cbc9a91fc403b34a18">&#9670;&nbsp;</a></span>tasks</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structtask.html">task</a> tasks[<a class="el" href="user_8h.html#aa3bb33230c3f665f70c09261ad9d05bb">TASK_COUNT</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="user_8c_source.html#l00022">22</a> of file <a class="el" href="user_8c_source.html">user.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
