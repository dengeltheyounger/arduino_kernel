\hypertarget{tasks_8h_source}{}\doxysection{tasks.\+h}
\label{tasks_8h_source}\index{include/sys/tasks.h@{include/sys/tasks.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef TASKS\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define TASKS\_H}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <stdint.h>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}stack.h"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <avr/io.h>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#define ADDR\_LO(LABEL)  LABEL \& 0xff}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#define ADDR\_HI(LABEL)  (LABEL \& 0xff00) >> 8}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{comment}{/* Right now there are only two}}
\DoxyCodeLine{13 \textcolor{comment}{ * task states. The only possible}}
\DoxyCodeLine{14 \textcolor{comment}{ * reason why this would be necessary}}
\DoxyCodeLine{15 \textcolor{comment}{ * is if the programmer had a task}}
\DoxyCodeLine{16 \textcolor{comment}{ * that could end, and wanted to use}}
\DoxyCodeLine{17 \textcolor{comment}{ * the stack space of that task later.}}
\DoxyCodeLine{18 \textcolor{comment}{ */}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} task\_state \{}
\DoxyCodeLine{21     runnable = 0,}
\DoxyCodeLine{22     complete = 1,}
\DoxyCodeLine{23     waiting = 2}
\DoxyCodeLine{24 \} task\_state;}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{keyword}{struct }\mbox{\hyperlink{structcontext}{context}} \{}
\DoxyCodeLine{27     \textcolor{keywordtype}{void} *sp\_start;}
\DoxyCodeLine{28     \textcolor{keywordtype}{void} *sp;}
\DoxyCodeLine{29     uint8\_t r0;}
\DoxyCodeLine{30     \textcolor{comment}{/* r1 should always contain zero. Must be saved during ISR prologue. Must be zeroed out during}}
\DoxyCodeLine{31 \textcolor{comment}{     * the ISR routine. Must be restored during ISR epilogue}}
\DoxyCodeLine{32 \textcolor{comment}{     */}}
\DoxyCodeLine{33     uint8\_t r1;}
\DoxyCodeLine{34     uint8\_t r2;}
\DoxyCodeLine{35     uint8\_t r3;}
\DoxyCodeLine{36     uint8\_t r4;}
\DoxyCodeLine{37     uint8\_t r5;}
\DoxyCodeLine{38     uint8\_t r6;}
\DoxyCodeLine{39     uint8\_t r7;}
\DoxyCodeLine{40     uint8\_t r8;}
\DoxyCodeLine{41     uint8\_t r9;}
\DoxyCodeLine{42     uint8\_t r10;}
\DoxyCodeLine{43     uint8\_t r11;}
\DoxyCodeLine{44     uint8\_t r12;}
\DoxyCodeLine{45     uint8\_t r13;}
\DoxyCodeLine{46     uint8\_t r14;}
\DoxyCodeLine{47     uint8\_t r15;}
\DoxyCodeLine{48     uint8\_t r16;}
\DoxyCodeLine{49     uint8\_t r17;}
\DoxyCodeLine{50     uint8\_t r18;}
\DoxyCodeLine{51     uint8\_t r19;}
\DoxyCodeLine{52     uint8\_t r20;}
\DoxyCodeLine{53     uint8\_t r21;}
\DoxyCodeLine{54     uint8\_t r22;}
\DoxyCodeLine{55     uint8\_t r23;}
\DoxyCodeLine{56     uint8\_t r24;}
\DoxyCodeLine{57     uint8\_t r25;}
\DoxyCodeLine{58     uint8\_t r26;}
\DoxyCodeLine{59     uint8\_t r27;}
\DoxyCodeLine{60     uint8\_t r28;}
\DoxyCodeLine{61     uint8\_t r29;}
\DoxyCodeLine{62     uint8\_t r30;}
\DoxyCodeLine{63     uint8\_t r31;}
\DoxyCodeLine{64 \};}
\DoxyCodeLine{65 }
\DoxyCodeLine{66 \textcolor{comment}{// This is a linked list for the task structs}}
\DoxyCodeLine{67 }
\DoxyCodeLine{68 \textcolor{keyword}{struct }\mbox{\hyperlink{structtask}{task}} \{}
\DoxyCodeLine{69     \textcolor{keyword}{struct }\mbox{\hyperlink{structcontext}{context}} c;}
\DoxyCodeLine{70     \textcolor{keyword}{struct }\mbox{\hyperlink{structtask}{task}} *next;}
\DoxyCodeLine{71     task\_state state;}
\DoxyCodeLine{72     void (*task\_funct)(); }
\DoxyCodeLine{73 \};}
\DoxyCodeLine{74 }
\DoxyCodeLine{75 \textcolor{comment}{/* Set up the current task struct. If prev is not null, then}}
\DoxyCodeLine{76 \textcolor{comment}{ * curr will be set as next. In addition, curr's task\_funct will}}
\DoxyCodeLine{77 \textcolor{comment}{ * point to the function provided. Finally, the pc member of c for}}
\DoxyCodeLine{78 \textcolor{comment}{ * curr will point to the address of task\_launch.}}
\DoxyCodeLine{79 \textcolor{comment}{ *}}
\DoxyCodeLine{80 \textcolor{comment}{ * It is assumed that the programmer is smart enough not to }}
\DoxyCodeLine{81 \textcolor{comment}{ * make either curr or task\_funct null}}
\DoxyCodeLine{82 \textcolor{comment}{ */}}
\DoxyCodeLine{83 \textcolor{keywordtype}{void} make\_task(\textcolor{keyword}{struct} \mbox{\hyperlink{structtask}{task}} *p, \textcolor{keyword}{struct} \mbox{\hyperlink{structtask}{task}} *curr, \textcolor{keywordtype}{void} (*task\_funct)());}
\DoxyCodeLine{84 }
\DoxyCodeLine{85 }
\DoxyCodeLine{86 \textcolor{comment}{/* Assign a stack for each task struct. If there are more}}
\DoxyCodeLine{87 \textcolor{comment}{ * tasks than stacks, then it will exit with error.}}
\DoxyCodeLine{88 \textcolor{comment}{ */}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{keywordtype}{int} set\_task\_stacks(\textcolor{keyword}{struct} \mbox{\hyperlink{structtask}{task}} *t, \textcolor{keywordtype}{size\_t} task\_num,}
\DoxyCodeLine{91             \textcolor{keyword}{struct} \mbox{\hyperlink{structstack}{stack}} *s, \textcolor{keywordtype}{size\_t} stack\_num);}
\DoxyCodeLine{92 }
\DoxyCodeLine{93 \textcolor{comment}{/* Mark the task as complete. Since the taska aren't}}
\DoxyCodeLine{94 \textcolor{comment}{ * actually suppposed to exit, this tells the scheduler}}
\DoxyCodeLine{95 \textcolor{comment}{ * not to choose that task, since it's dead.}}
\DoxyCodeLine{96 \textcolor{comment}{ */}}
\DoxyCodeLine{97 \textcolor{keywordtype}{void} end\_task(\textcolor{keyword}{struct} \mbox{\hyperlink{structtask}{task}} *t);}
\DoxyCodeLine{98 }
\DoxyCodeLine{99 \textcolor{comment}{// run task}}
\DoxyCodeLine{100 \textcolor{keywordtype}{void} do\_task(\textcolor{keyword}{struct} \mbox{\hyperlink{structtask}{task}} *t);}
\DoxyCodeLine{101 }
\DoxyCodeLine{102 \textcolor{keyword}{extern} \textcolor{keyword}{struct }\mbox{\hyperlink{structtask}{task}} *curr;}
\DoxyCodeLine{103 }
\DoxyCodeLine{104 \textcolor{comment}{/* Iterate through the set of tasks to find one that is}}
\DoxyCodeLine{105 \textcolor{comment}{ * runnable. If there is no runnable task found, then}}
\DoxyCodeLine{106 \textcolor{comment}{ * return false. If a runnable task is found, then save it}}
\DoxyCodeLine{107 \textcolor{comment}{ * in curr, and then return true.}}
\DoxyCodeLine{108 \textcolor{comment}{ */}}
\DoxyCodeLine{109 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} get\_next\_task();}
\DoxyCodeLine{110     }
\DoxyCodeLine{111 }
\DoxyCodeLine{112 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
